import React, { useState, useEffect, useRef } from 'react';
import { 
  Heart, Brain, Sparkles, User, MessageCircle, Trophy, 
  TrendingUp, Calendar, Star, Shield, Zap, Coffee,
  Sunrise, Moon, ChevronRight, ArrowRight, Smile,
  Frown, Meh, ThumbsUp, Award, Target, Clock
} from 'lucide-react';

// ============================================
// AI MENTOR - EMOCJONALNY SYSTEM
// ============================================

class EmotionalAI {
  constructor() {
    this.userProfile = {
      name: '',
      career: '',
      mood: [],
      motivations: [],
      challenges: [],
      achievements: [],
      conversations: [],
      emotionalState: 'neutral',
      lastInteraction: null
    };

    this.narratives = {
      electrician: {
        intro: "âš¡ Od teraz jesteÅ› Czeladnikiem PrÄ…du. TwÃ³j mistrz czeka w warsztacie z pierwszym zadaniem.",
        daily: [
          "KaÅ¼de gniazdko, ktÃ³re naprawisz, to bezpieczeÅ„stwo czyjejÅ› rodziny.",
          "PamiÄ™taj - kontrolujesz moc, ktÃ³ra napÄ™dza caÅ‚y Å›wiat.",
          "DziÅ› nauczysz siÄ™, jak Å›wiatÅ‚o pokonuje ciemnoÅ›Ä‡ - dosÅ‚ownie."
        ],
        motivation: "ElektrycznoÅ›Ä‡ to krew nowoczesnego Å›wiata. Bez Ciebie wszystko staje."
      },
      chef: {
        intro: "ğŸ‘¨â€ğŸ³ Witaj w kuchni mistrzÃ³w! TwÃ³j fartuch czeka, a pierwszy przepis juÅ¼ paruje na kuchence.",
        daily: [
          "KaÅ¼de danie to historia opowiedziana smakiem.",
          "DziÅ› stworzysz coÅ›, co ktoÅ› zapamiÄ™ta na zawsze.",
          "Kuchnia to alchemia - zamieniasz skÅ‚adniki w emocje."
        ],
        motivation: "Karmisz nie tylko ciaÅ‚a, ale i dusze. To szlachetna misja."
      },
      mechanic: {
        intro: "ğŸ”§ Masz juÅ¼ fartuch i klucze â€“ czas zanurzyÄ‡ siÄ™ w oleju i odkryÄ‡ tajemnice silnikÃ³w.",
        daily: [
          "KaÅ¼dy naprawiony samochÃ³d to czyjaÅ› wolnoÅ›Ä‡ przywrÃ³cona.",
          "Silnik to serce maszyny - dziÅ› nauczysz siÄ™ je leczyÄ‡.",
          "Twoje rÄ™ce przywracajÄ… Å¼ycie metalowym gigantom."
        ],
        motivation: "Mechanicy to wspÃ³Å‚czeÅ›ni kowale - kujesz bezpieczeÅ„stwo na drogach."
      },
      developer: {
        intro: "ğŸ’» Witaj w cyfrowym warsztacie! Terminal czeka na Twoje pierwsze polecenie.",
        daily: [
          "KaÅ¼da linia kodu to cegieÅ‚ka w cyfrowej przyszÅ‚oÅ›ci.",
          "DziÅ› stworzysz coÅ› z niczego - tylko z logiki i kreatywnoÅ›ci.",
          "Debugowanie to jak rozwiÄ…zywanie zagadek - satysfakcja gwarantowana."
        ],
        motivation: "ProgramiÅ›ci to architekci cyfrowego Å›wiata. Budujesz przyszÅ‚oÅ›Ä‡."
      }
    };

    this.moodResponses = {
      happy: [
        "Åšwietnie siÄ™ cieszÄ™, Å¼e masz dobry dzieÅ„! Ta energia pomoÅ¼e Ci w nauce.",
        "TwÃ³j entuzjazm jest zaraÅºliwy! Wykorzystajmy go do czegoÅ› wielkiego.",
        "Z takÄ… pozytywnÄ… energiÄ… moÅ¼esz gÃ³ry przenosiÄ‡!"
      ],
      sad: [
        "Hej, kaÅ¼dy ma gorsze dni. PamiÄ™taj, Å¼e uczysz siÄ™ dla siebie i swojej przyszÅ‚oÅ›ci.",
        "Wiem, Å¼e jest ciÄ™Å¼ko. Ale wÅ‚aÅ›nie w takich momentach wykuwa siÄ™ charakter.",
        "MoÅ¼e zrÃ³bmy dziÅ› coÅ› Å‚atwiejszego? MaÅ‚e kroki teÅ¼ prowadzÄ… do celu."
      ],
      stressed: [
        "WidzÄ™, Å¼e masz duÅ¼o na gÅ‚owie. PamiÄ™taj - nie musisz wszystkiego robiÄ‡ naraz.",
        "Stres to znak, Å¼e to dla Ciebie waÅ¼ne. WeÅº gÅ‚Ä™boki oddech, podzielimy to na maÅ‚e kroki.",
        "KaÅ¼dy ekspert kiedyÅ› byÅ‚ poczÄ…tkujÄ…cym. Daj sobie czas."
      ],
      motivated: [
        "WOW! Z takÄ… motywacjÄ… moÅ¼esz wszystko! Co chcesz dziÅ› osiÄ…gnÄ…Ä‡?",
        "CzujÄ™ TwojÄ… determinacjÄ™! To jest moment, Å¼eby zrobiÄ‡ coÅ› wielkiego.",
        "Twoja motywacja mnie inspiruje! DziaÅ‚ajmy!"
      ]
    };
  }

  analyzeMood(moodData) {
    const moodScore = moodData.reduce((acc, m) => acc + m.value, 0) / moodData.length;
    
    if (moodScore > 7) return 'happy';
    if (moodScore > 5) return 'motivated';
    if (moodScore > 3) return 'neutral';
    if (moodScore > 2) return 'stressed';
    return 'sad';
  }

  generateDailyGreeting(user) {
    const hour = new Date().getHours();
    const daysSinceStart = Math.floor((Date.now() - user.startDate) / (1000 * 60 * 60 * 24));
    const lastMood = user.moods[user.moods.length - 1];
    
    let greeting = '';
    
    // Time-based greeting
    if (hour < 6)       greeting = `${user.name}, wczeÅ›nie wstaÅ‚eÅ›! Podziwiam TwojÄ… determinacjÄ™. `;
    else if (hour < 12) greeting = `DzieÅ„ dobry, ${user.name}! `;
    else if (hour < 18) greeting = `CzeÅ›Ä‡ ${user.name}! `;
    else if (hour < 22) greeting = `Dobry wieczÃ³r, ${user.name}! `;
    else greeting = `${user.name}, pracujesz do pÃ³Åºna! `;

    // Personalized follow-up based on history
    if (daysSinceStart === 0) {
      greeting += "Jak siÄ™ czujesz przed pierwszym dniem nauki?";
    } else if (user.streak > 7) {
      greeting += `${user.streak} dni z rzÄ™du! JesteÅ› nie do zatrzymania! ğŸ”¥`;
    } else if (lastMood && lastMood.value < 5) {
      greeting += "Wczoraj miaÅ‚eÅ› trudny dzieÅ„. DziÅ› bÄ™dzie lepiej, obiecujÄ™!";
    } else if (user.lastAchievement) {
      greeting += `PamiÄ™tasz jak wczoraj zdobyÅ‚eÅ› '${user.lastAchievement}'? DziÅ› czeka kolejne wyzwanie!`;
    } else {
      const narrative = this.narratives[user.career]?.daily;
      if (narrative) {
        greeting += narrative[Math.floor(Math.random() * narrative.length)];
      }
    }

    return greeting;
  }

  generateMotivation(user, context) {
    const career = user.career;
    const narrative = this.narratives[career];
    
    if (!narrative) return "KaÅ¼dy krok przybliÅ¼a CiÄ™ do celu!";

    let motivation = narrative.motivation + " ";

    // Add context-specific motivation
    if (context.type === 'failure') {
      motivation += "BÅ‚Ä™dy to najlepsi nauczyciele. Edison teÅ¼ nie wynalazÅ‚ Å¼arÃ³wki za pierwszym razem.";
    } else if (context.type === 'success') {
      motivation += `WÅ‚aÅ›nie udowodniÅ‚eÅ›, Å¼e masz to, czego potrzeba. ${user.completedTasks} zadaÅ„ za TobÄ…!`;
    } else if (context.type === 'streak') {
      motivation += `${user.streak} dni ciÄ…gÅ‚ej nauki! Statystycznie, jesteÅ› w top 5% najbardziej zdeterminowanych.`;
    }

    // Add social impact
    motivation += this.getSocialImpact(career);

    return motivation;
  }

  getSocialImpact(career) {
    const impacts = {
      electrician: " Twoja praca ratuje Å¼ycie - wadliwa instalacja to Å›miertelne zagroÅ¼enie. JesteÅ› bohaterem bezpieczeÅ„stwa.",
      chef: " Gotowanie to miÅ‚oÅ›Ä‡ podana na talerzu. Tworzysz wspomnienia i Å‚Ä…czysz ludzi przy stole.",
      mechanic: " KaÅ¼dy naprawiony pojazd to rodzina bezpiecznie docierajÄ…ca do domu. To wielka odpowiedzialnoÅ›Ä‡.",
      developer: " TwÃ³j kod moÅ¼e zmieniÄ‡ Å¼ycie milionÃ³w. Facebook, Google - wszystko zaczÄ™Å‚o siÄ™ od jednej osoby z laptopem.",
      nurse: " BÄ™dziesz pierwszÄ… osobÄ…, ktÃ³rÄ… zobaczÄ… chorzy. TwÃ³j uÅ›miech moÅ¼e byÄ‡ ich jedynÄ… nadziejÄ….",
      carpenter: " Budujesz schronienie, bezpieczeÅ„stwo, dom. To fundament cywilizacji."
    };

    return impacts[career] || " Twoja praca ma znaczenie. Åšwiat potrzebuje takich jak Ty.";
  }

  rememberConversation(topic, response, emotion) {
    this.userProfile.conversations.push({
      date: new Date(),
      topic,
      response,
      emotion,
      id: Date.now()
    });

    // Keep only last 50 conversations
    if (this.userProfile.conversations.length > 50) {
      this.userProfile.conversations.shift();
    }
  }

  getFollowUp() {
    const lastConvo = this.userProfile.conversations[this.userProfile.conversations.length - 1];
    
    if (!lastConvo) return null;

    const daysSince = Math.floor((Date.now() - lastConvo.date) / (1000 * 60 * 60 * 24));
    
    if (daysSince > 3 && daysSince < 7) {
      return `PamiÄ™tasz jak ${daysSince} dni temu rozmawialiÅ›my o ${lastConvo.topic}? Jak Ci poszÅ‚o?`;
    }

    return null;
  }
}

// ============================================
// CAREER PATH QUIZ - PSYCHOLOGICZNY TEST
// ============================================

const CareerQuiz = ({ onComplete }) => {
  const [currentQuestion, setCurrentQuestion] = useState(0);
  const [answers, setAnswers] = useState([]);
  
  const questions = [
    {
      id: 'work_environment',
      question: "WyobraÅº sobie idealny dzieÅ„ pracy. Gdzie jesteÅ›?",
      answers: [
        { text: "W warsztacie peÅ‚nym narzÄ™dzi", value: ['mechanic', 'electrician', 'carpenter'], emoji: "ğŸ”§" },
        { text: "Przy komputerze w cichym biurze", value: ['developer', 'designer', 'analyst'], emoji: "ğŸ’»" },
        { text: "W kuchni peÅ‚nej aromatÃ³w", value: ['chef', 'baker'], emoji: "ğŸ‘¨â€ğŸ³" },
        { text: "WÅ›rÃ³d ludzi, pomagajÄ…c im", value: ['nurse', 'teacher', 'therapist'], emoji: "ğŸ¤" }
      ]
    },
    {
      id: 'problem_solving',
      question: "PopsÑƒĞ» siÄ™ telewizor. Co robisz?",
      answers: [
        { text: "Otwieram go i sprawdzam co jest nie tak", value: ['electrician', 'mechanic'], emoji: "ğŸ”Œ" },
        { text: "Szukam rozwiÄ…zania w internecie", value: ['developer', 'analyst'], emoji: "ğŸ”" },
        { text: "DzwoniÄ™ do specjalisty", value: ['manager', 'coordinator'], emoji: "ğŸ“" },
        { text: "To dobra okazja Å¼eby kupiÄ‡ nowy", value: ['sales', 'marketing'], emoji: "ğŸ›ï¸" }
      ]
    },
    {
      id: 'creativity',
      question: "Dostajesz pudeÅ‚ko losowych przedmiotÃ³w. Co z nimi robisz?",
      answers: [
        { text: "BudujÄ™ coÅ› uÅ¼ytecznego", value: ['carpenter', 'engineer'], emoji: "ğŸ—ï¸" },
        { text: "TworzÄ™ dzieÅ‚o sztuki", value: ['designer', 'artist'], emoji: "ğŸ¨" },
        { text: "OrganizujÄ™ je systematycznie", value: ['analyst', 'accountant'], emoji: "ğŸ“Š" },
        { text: "WymyÅ›lam historiÄ™ o nich", value: ['writer', 'teacher'], emoji: "ğŸ“–" }
      ]
    },
    {
      id: 'stress_response',
      question: "Jest deadline za 2 godziny, a praca w poÅ‚owie. Co czujesz?",
      answers: [
        { text: "Adrenalina! Teraz dam z siebie 200%", value: ['paramedic', 'chef'], emoji: "âš¡" },
        { text: "Spokojnie planujÄ™ co najwaÅ¼niejsze", value: ['developer', 'engineer'], emoji: "ğŸ“‹" },
        { text: "StresujÄ™ siÄ™, ale dziaÅ‚am", value: ['teacher', 'nurse'], emoji: "ğŸ˜°" },
        { text: "Szukam pomocy zespoÅ‚u", value: ['manager', 'coordinator'], emoji: "ğŸ‘¥" }
      ]
    },
    {
      id: 'satisfaction',
      question: "Co daje Ci najwiÄ™kszÄ… satysfakcjÄ™?",
      answers: [
        { text: "Gdy coÅ›, co zepsute, znÃ³w dziaÅ‚a", value: ['mechanic', 'electrician'], emoji: "âœ…" },
        { text: "Gdy ktoÅ› mÃ³wi 'dziÄ™kujÄ™'", value: ['nurse', 'teacher', 'therapist'], emoji: "ğŸ™" },
        { text: "Gdy widzÄ™ efekt swojej pracy", value: ['carpenter', 'chef', 'designer'], emoji: "ğŸ†" },
        { text: "Gdy rozwiÄ…Å¼Ä™ skomplikowany problem", value: ['developer', 'analyst'], emoji: "ğŸ§©" }
      ]
    }
  ];

  const handleAnswer = (answer) => {
    const newAnswers = [...answers, answer];
    setAnswers(newAnswers);

    if (currentQuestion < questions.length - 1) {
      setCurrentQuestion(currentQuestion + 1);
    } else {
      // Analyze answers
      const careerScores = {};
      newAnswers.forEach(ans => {
        ans.value.forEach(career => {
          careerScores[career] = (careerScores[career] || 0) + 1;
        });
      });

      // Get top 3 careers
      const sortedCareers = Object.entries(careerScores)
        .sort((a, b) => b[1] - a[1])
        .slice(0, 3);

      onComplete({
        topCareer: sortedCareers[0][0],
        alternatives: sortedCareers.slice(1).map(c => c[0]),
        scores: careerScores
      });
    }
  };

  const progress = ((currentQuestion + 1) / questions.length) * 100;

  return (
    <div className="min-h-screen bg-gradient-to-br from-purple-600 via-blue-600 to-cyan-600 p-6">
      <div className="max-w-2xl mx-auto">
        {/* Progress Bar */}
        <div className="mb-8">
          <div className="flex justify-between items-center mb-2">
            <span className="text-white font-semibold">Pytanie {currentQuestion + 1} z {questions.length}</span>
            <span className="text-white">{Math.round(progress)}%</span>
          </div>
          <div className="h-3 bg-white/20 rounded-full overflow-hidden">
            <div 
              className="h-full bg-white transition-all duration-500 ease-out"
              style={{ width: `${progress}%` }}
            />
          </div>
        </div>

        {/* Question Card */}
        <div className="bg-white rounded-3xl shadow-2xl p-8 transform transition-all duration-500">
          <div className="text-center mb-8">
            <div className="text-6xl mb-4">ğŸ¤”</div>
            <h2 className="text-2xl font-bold text-gray-800 mb-2">
              {questions[currentQuestion].question}
            </h2>
          </div>

          <div className="space-y-4">
            {questions[currentQuestion].answers.map((answer, idx) => (
              <button
                key={idx}
                onClick={() => handleAnswer(answer)}
                className="w-full p-6 bg-gradient-to-r from-blue-50 to-purple-50 rounded-2xl hover:from-blue-100 hover:to-purple-100 transform hover:scale-105 transition-all duration-300 text-left flex items-center space-x-4 group"
              >
                <span className="text-4xl group-hover:animate-bounce">{answer.emoji}</span>
                <span className="text-lg font-medium text-gray-800">{answer.text}</span>
              </button>
            ))}
          </div>
        </div>
      </div>
    </div>
  );
};

// ============================================
// DAILY MOOD CHECK - EMOCJONALNY CHECK-IN
// ============================================

const DailyMoodCheck = ({ onComplete, userName, previousMoods = [] }) => {
  const [mood, setMood] = useState(5);
  const [feeling, setFeeling] = useState('');
  const [motivation, setMotivation] = useState('');
  const [showFollowUp, setShowFollowUp] = useState(false);
  
  const ai = useRef(new EmotionalAI()).current;

  const feelings = [
    { emoji: 'ğŸ˜Š', label: 'SzczÄ™Å›liwy', value: 'happy' },
    { emoji: 'ğŸ˜”', label: 'Smutny', value: 'sad' },
    { emoji: 'ğŸ˜Ÿ', label: 'Zestresowany', value: 'stressed' },
    { emoji: 'ğŸ˜´', label: 'ZmÄ™czony', value: 'tired' },
    { emoji: 'ğŸ’ª', label: 'Zmotywowany', value: 'motivated' },
    { emoji: 'ğŸ˜', label: 'Neutralny', value: 'neutral' }
  ];

  const motivations = [
    "ChcÄ™ lepiej zarabiaÄ‡",
    "Szukam nowej pasji",
    "Rodzina na mnie liczy",
    "ChcÄ™ byÄ‡ niezaleÅ¼ny",
    "Nudzi mnie obecna praca",
    "MarzÄ™ o wÅ‚asnym biznesie"
  ];

  const handleSubmit = () => {
    const moodData = {
      date: new Date(),
      mood,
      feeling,
      motivation,
      followUp: null
    };

    // Generate AI response based on mood
    const aiMood = ai.analyzeMood([{ value: mood }]);
    const response = ai.moodResponses[aiMood][Math.floor(Math.random() * ai.moodResponses[aiMood].length)];
    
    moodData.aiResponse = response;

    // Check if we should ask follow-up based on patterns
    if (previousMoods.length > 2) {
      const lastThreeMoods = previousMoods.slice(-3);
      const avgMood = lastThreeMoods.reduce((a, b) => a + b.mood, 0) / 3;
      
      if (avgMood < 4) {
        setShowFollowUp(true);
        return;
      }
    }

    onComplete(moodData);
  };

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-6 z-50">
      <div className="bg-white rounded-3xl max-w-lg w-full p-8 transform transition-all">
        {!showFollowUp ? (
          <>
            <div className="text-center mb-6">
              <h2 className="text-2xl font-bold mb-2">
                CzeÅ›Ä‡ {userName}! ğŸ‘‹
              </h2>
              <p className="text-gray-600">Jak siÄ™ dziÅ› czujesz?</p>
            </div>

            {/* Mood Slider */}
            <div className="mb-8">
              <div className="flex justify-between mb-4">
                <span className="text-3xl">ğŸ˜¢</span>
                <span className="text-3xl">ğŸ˜</span>
                <span className="text-3xl">ğŸ˜Š</span>
              </div>
              <input
                type="range"
                min="1"
                max="10"
                value={mood}
                onChange={(e) => setMood(Number(e.target.value))}
                className="w-full h-3 bg-gradient-to-r from-red-400 via-yellow-400 to-green-400 rounded-full appearance-none cursor-pointer"
              />
              <div className="text-center mt-2 text-4xl font-bold">
                {mood}/10
              </div>
            </div>

            {/* Feelings */}
            <div className="mb-6">
              <p className="font-semibold mb-3">Co najbardziej opisuje TwÃ³j stan?</p>
              <div className="grid grid-cols-3 gap-3">
                {feelings.map(f => (
                  <button
                    key={f.value}
                    onClick={() => setFeeling(f.value)}
                    className={`p-3 rounded-xl transition-all ${
                      feeling === f.value 
                        ? 'bg-blue-100 border-2 border-blue-500' 
                        : 'bg-gray-50 hover:bg-gray-100'
                    }`}
                  >
                    <div className="text-2xl mb-1">{f.emoji}</div>
                    <div className="text-xs">{f.label}</div>
                  </button>
                ))}
              </div>
            </div>

            {/* Motivation */}
            <div className="mb-6">
              <p className="font-semibold mb-3">Co CiÄ™ motywuje do nauki?</p>
              <div className="space-y-2">
                {motivations.map(m => (
                  <button
                    key={m}
                    onClick={() => setMotivation(m)}
                    className={`w-full text-left p-3 rounded-lg transition-all ${
                      motivation === m
                        ? 'bg-purple-100 border-2 border-purple-500'
                        : 'bg-gray-50 hover:bg-gray-100'
                    }`}
                  >
                    {m}
                  </button>
                ))}
              </div>
            </div>

            <button
              onClick={handleSubmit}
              className="w-full py-4 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-xl font-bold hover:from-blue-700 hover:to-purple-700 transition-all"
            >
              Zacznij dzieÅ„ nauki â†’
            </button>
          </>
        ) : (
          <div className="text-center">
            <div className="text-6xl mb-4">ğŸ¤—</div>
            <h3 className="text-xl font-bold mb-4">
              ZauwaÅ¼yÅ‚em, Å¼e ostatnio jest Ci ciÄ™Å¼ko...
            </h3>
            <p className="text-gray-600 mb-6">
              PamiÄ™taj, Å¼e nie jesteÅ› sam. KaÅ¼dy sukces zaczyna siÄ™ od maÅ‚ego kroku.
              MoÅ¼e dziÅ› zrÃ³bmy coÅ› Å‚atwiejszego? Albo po prostu porozmawiajmy?
            </p>
            <div className="space-y-3">
              <button
                onClick={() => onComplete({ needsSupport: true })}
                className="w-full py-3 bg-green-500 text-white rounded-xl font-bold"
              >
                Tak, potrzebujÄ™ wsparcia
              </button>
              <button
                onClick={() => onComplete({ needsSupport: false })}
                className="w-full py-3 bg-gray-200 text-gray-700 rounded-xl"
              >
                Nie, dam radÄ™
              </button>
            </div>
          </div>
        )}
      </div>
    </div>
  );
};

// ============================================
// MAIN IMMERSIVE CAREER SYSTEM
// ============================================

const ImmersiveCareerSystem = () => {
  const [stage, setStage] = useState('welcome'); // welcome, quiz, mood, career
  const [userData, setUserData] = useState({
    name: '',
    career: null,
    level: 1,
    xp: 0,
    streak: 0,
    moods: [],
    lastInteraction: null
  });
  
  const [showDailyMood, setShowDailyMood] = useState(false);
  const [selectedPath, setSelectedPath] = useState(null);
  
  const ai = useRef(new EmotionalAI()).current;

  // Career narratives with immersive descriptions
  const careers = {
    electrician: {
      title: "Elektryk - Mistrz PrÄ…du",
      emoji: "âš¡",
      narrative: "Kontrolujesz niewidzialnÄ… siÅ‚Ä™, ktÃ³ra napÄ™dza Å›wiat. KaÅ¼de Twoje dziaÅ‚anie to bezpieczeÅ„stwo tysiÄ™cy ludzi.",
      firstDay: "Pierwszy dzieÅ„ w warsztacie. Mistrz Kowalski, 30 lat doÅ›wiadczenia, wita CiÄ™ sÅ‚owami: 'PrÄ…d nie wybacza bÅ‚Ä™dÃ³w, ale szanuje tych, ktÃ³rzy go rozumiejÄ….'",
      missions: [
        "Misja 1: Pierwsza Instalacja - PodÅ‚Ä…cz gniazdko w sposÃ³b bezpieczny",
        "Misja 2: Diagnostyka - ZnajdÅº usterkÄ™ w domowej instalacji",
        "Misja 3: Modernizacja - WymieÅ„ stary bezpiecznik na nowoczesny"
      ]
    },
    chef: {
      title: "Szef Kuchni - Alchemik SmakÃ³w",
      emoji: "ğŸ‘¨â€ğŸ³",
      narrative: "Tworzysz sztukÄ™, ktÃ³rÄ… moÅ¼na zjeÅ›Ä‡. KaÅ¼de danie to emocja podana na talerzu.",
      firstDay: "Szef kuchni prowadzi CiÄ™ do stanowiska: 'NÃ³Å¼ to przedÅ‚uÅ¼enie Twojej rÄ™ki, a kuchnia to Twoja scena. PokaÅ¼, co potrafisz.'",
      missions: [
        "Misja 1: Mise en Place - Przygotuj idealne stanowisko pracy",
        "Misja 2: Pierwszy Sos - StwÃ³rz klasyczny sos holenderski",
        "Misja 3: Serwis - Wydaj 10 daÅ„ w czasie kolacji"
      ]
    },
    developer: {
      title: "Programista - Architekt Cyfrowego Åšwiata",
      emoji: "ğŸ’»",
      narrative: "Piszesz przyszÅ‚oÅ›Ä‡ linijka po linijce. TwÃ³j kod moÅ¼e zmieniÄ‡ Å¼ycie milionÃ³w.",
      firstDay: "Senior developer wita CiÄ™: 'Pierwszy pull request zawsze pamiÄ™ta siÄ™ najdÅ‚uÅ¼ej. Kod to poezja - ma byÄ‡ piÄ™kny i funkcjonalny.'",
      missions: [
        "Misja 1: Hello World - StwÃ³rz pierwszÄ… aplikacjÄ™",
        "Misja 2: Debug Master - ZnajdÅº i napraw 5 bÅ‚Ä™dÃ³w",
        "Misja 3: Feature - Dodaj nowÄ… funkcjonalnoÅ›Ä‡ do projektu"
      ]
    },
    mechanic: {
      title: "Mechanik - Lekarz Maszyn",
      emoji: "ğŸ”§",
      narrative: "Rozumiesz jÄ™zyk silnikÃ³w. KaÅ¼da naprawa to przywrÃ³cona wolnoÅ›Ä‡ podrÃ³Å¼owania.",
      firstDay: "Warsztat pachnie olejem i metalem. Majster podaje Ci klucze: 'Silnik ma duszÄ™. Naucz siÄ™ jej sÅ‚uchaÄ‡.'",
      missions: [
        "Misja 1: Diagnoza - Zidentyfikuj problem w silniku",
        "Misja 2: Wymiana - WymieÅ„ klocki hamulcowe",
        "Misja 3: Tuning - ZwiÄ™ksz moc silnika o 10%"
      ]
    }
  };

  useEffect(() => {
    // Check if it's a new day
    const lastInteraction = localStorage.getItem('lastInteraction');
    if (lastInteraction) {
      const last = new Date(lastInteraction);
      const now = new Date();
      
      if (last.getDate() !== now.getDate()) {
        setShowDailyMood(true);
      }
    }
  }, []);

  const handleQuizComplete = (results) => {
    setUserData({
      ...userData,
      recommendedCareer: results.topCareer,
      alternatives: results.alternatives
    });
    setStage('career-intro');
  };

  // Render different stages
  if (stage === 'welcome') {
    return (
      <div className="min-h-screen bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center p-6">
        <div className="bg-white rounded-3xl p-12 max-w-2xl text-center shadow-2xl">
          <div className="text-8xl mb-6">ğŸš€</div>
          <h1 className="text-4xl font-bold mb-4">Witaj w PathFinder</h1>
          <p className="text-xl text-gray-600 mb-8">
            Znajdziemy dla Ciebie idealnÄ… Å›cieÅ¼kÄ™ kariery i poprowadzimy CiÄ™ przez niÄ… krok po kroku
          </p>
          
          <input
            type="text"
            placeholder="Jak masz na imiÄ™?"
            className="w-full px-6 py-4 text-xl border-2 border-gray-300 rounded-2xl mb-6 focus:border-blue-500 focus:outline-none"
            value={userData.name}
            onChange={(e) => setUserData({...userData, name: e.target.value})}
          />
          
          <button
            onClick={() => userData.name && setStage('quiz')}
            disabled={!userData.name}
            className={`w-full py-4 text-xl font-bold rounded-2xl transition-all ${
              userData.name
                ? 'bg-gradient-to-r from-blue-600 to-purple-600 text-white hover:from-blue-700 hover:to-purple-700'
                : 'bg-gray-200 text-gray-400'
            }`}
          >
            Rozpocznij Test Predyspozycji â†’
          </button>
        </div>
      </div>
    );
  }

  if (stage === 'quiz') {
    return <CareerQuiz onComplete={handleQuizComplete} />;
  }

  if (showDailyMood) {
    return (
      <DailyMoodCheck
        onComplete={handleMoodComplete}
        userName={userData.name}
        previousMoods={userData.moods}
      />
    );
  }

  if (stage === 'career-selection') {
    return (
      <div className="min-h-screen bg-gradient-to-br from-indigo-600 to-purple-600 p-6">
        <div className="max-w-4xl mx-auto">
          <div className="bg-white rounded-3xl p-8 shadow-2xl">
            <h2 className="text-3xl font-bold mb-2 text-center">
              {userData.name}, Twoja idealna Å›cieÅ¼ka to:
            </h2>
            
            <div className="bg-gradient-to-r from-green-50 to-blue-50 rounded-2xl p-6 mb-6">
              <div className="text-center">
                <div className="text-6xl mb-4">
                  {careers[userData.recommendedCareer]?.emoji || 'ğŸ¯'}
                </div>
                <h3 className="text-2xl font-bold mb-2">
                  {careers[userData.recommendedCareer]?.title || userData.recommendedCareer}
                </h3>
                <p className="text-gray-600">
                  {careers[userData.recommendedCareer]?.narrative}
                </p>
                <button
                  onClick={() => selectCareer(userData.recommendedCareer)}
                  className="mt-4 px-8 py-3 bg-green-600 text-white rounded-xl font-bold hover:bg-green-700 transition-all"
                >
                  Wybierz tÄ™ Å›cieÅ¼kÄ™ â†’
                </button>
              </div>
            </div>

            <div className="mb-4">
              <p className="font-semibold mb-3">Alternatywne Å›cieÅ¼ki dla Ciebie:</p>
              <div className="grid grid-cols-2 gap-4">
                {userData.alternatives?.map(alt => (
                  <button
                    key={alt}
                    onClick={() => selectCareer(alt)}
                    className="p-4 bg-gray-50 rounded-xl hover:bg-gray-100 transition-all text-left"
                  >
                    <div className="text-3xl mb-2">{careers[alt]?.emoji || 'ğŸ“š'}</div>
                    <div className="font-semibold">{careers[alt]?.title || alt}</div>
                  </button>
                ))}
              </div>
            </div>
          </div>
        </div>
      </div>
    );
  }

  if (stage === 'career-intro') {
    const career = careers[selectedPath];
    return (
      <div className="min-h-screen bg-gradient-to-br from-gray-900 to-gray-700 text-white p-6">
        <div className="max-w-4xl mx-auto">
          <div className="text-center mb-8">
            <div className="text-8xl mb-4 animate-pulse">{career.emoji}</div>
            <h1 className="text-4xl font-bold mb-4">{career.title}</h1>
            <p className="text-xl opacity-90 mb-8">{career.narrative}</p>
          </div>

          <div className="bg-white/10 backdrop-blur rounded-3xl p-8 mb-6">
            <h2 className="text-2xl font-bold mb-4">ğŸ“– RozdziaÅ‚ 1: Pierwszy DzieÅ„</h2>
            <p className="text-lg leading-relaxed mb-6">{career.firstDay}</p>
            
            <div className="space-y-4">
              <h3 className="text-xl font-semibold">Twoje pierwsze misje:</h3>
              {career.missions.map((mission, idx) => (
                <div key={idx} className="bg-white/5 rounded-xl p-4 flex items-center space-x-4">
                  <div className="text-3xl">ğŸ¯</div>
                  <div>
                    <p className="font-semibold">{mission}</p>
                    <p className="text-sm opacity-75">+100 XP â€¢ Czas: 30 min</p>
                  </div>
                </div>
              ))}
            </div>
          </div>

          <button
            className="w-full py-4 bg-gradient-to-r from-green-600 to-blue-600 rounded-2xl font-bold text-xl hover:from-green-700 hover:to-blue-700 transition-all"
            onClick={() => alert('Rozpoczynamy przygodÄ™!')}
          >
            Zaczynam PierwszÄ… MisjÄ™ â†’
          </button>
        </div>
      </div>
    );
  }

  return null;
};

export default ImmersiveCareerSystem;selection');
  };

  const handleMoodComplete = (moodData) => {
    const newMoods = [...userData.moods, moodData];
    setUserData({
      ...userData,
      moods: newMoods
    });
    
    localStorage.setItem('lastInteraction', new Date().toISOString());
    setShowDailyMood(false);

    // Show AI response
    if (moodData.aiResponse) {
      alert(moodData.aiResponse); // In real app, use a nice notification
    }
  };

  const selectCareer = (careerKey) => {
    setSelectedPath(careerKey);
    const career = careers[careerKey];
    
    // Show immersive narrative
    setUserData({
      ...userData,
      career: careerKey,
      narrative: career.narrative
    });
    
    setStage('career-


////NIE NIEDZIAÅA////


import React, { useState, useEffect, useRef } from 'react';
import { 
  Heart, Brain, Sparkles, User, MessageCircle, Trophy, 
  TrendingUp, Calendar, Star, Shield, Zap, Coffee,
  Sunrise, Moon, ChevronRight, ArrowRight, Smile,
  Frown, Meh, ThumbsUp, Award, Target, Clock
} from 'lucide-react';

// ============================================
// AI MENTOR - EMOCJONALNY SYSTEM
// ============================================

class EmotionalAI {
  constructor() {
    this.userProfile = {
      name: '',
      career: '',
      mood: [],
      motivations: [],
      challenges: [],
      achievements: [],
      conversations: [],
      emotionalState: 'neutral',
      lastInteraction: null
    };

    this.narratives = {
      electrician: {
        intro: "âš¡ Od teraz jesteÅ› Czeladnikiem PrÄ…du. TwÃ³j mistrz czeka w warsztacie z pierwszym zadaniem.",
        daily: [
          "KaÅ¼de gniazdko, ktÃ³re naprawisz, to bezpieczeÅ„stwo czyjejÅ› rodziny.",
          "PamiÄ™taj - kontrolujesz moc, ktÃ³ra napÄ™dza caÅ‚y Å›wiat.",
          "DziÅ› nauczysz siÄ™, jak Å›wiatÅ‚o pokonuje ciemnoÅ›Ä‡ - dosÅ‚ownie."
        ],
        motivation: "ElektrycznoÅ›Ä‡ to krew nowoczesnego Å›wiata. Bez Ciebie wszystko staje."
      },
      chef: {
        intro: "ğŸ‘¨â€ğŸ³ Witaj w kuchni mistrzÃ³w! TwÃ³j fartuch czeka, a pierwszy przepis juÅ¼ paruje na kuchence.",
        daily: [
          "KaÅ¼de danie to historia opowiedziana smakiem.",
          "DziÅ› stworzysz coÅ›, co ktoÅ› zapamiÄ™ta na zawsze.",
          "Kuchnia to alchemia - zamieniasz skÅ‚adniki w emocje."
        ],
        motivation: "Karmisz nie tylko ciaÅ‚a, ale i dusze. To szlachetna misja."
      },
      mechanic: {
        intro: "ğŸ”§ Masz juÅ¼ fartuch i klucze â€“ czas zanurzyÄ‡ siÄ™ w oleju i odkryÄ‡ tajemnice silnikÃ³w.",
        daily: [
          "KaÅ¼dy naprawiony samochÃ³d to czyjaÅ› wolnoÅ›Ä‡ przywrÃ³cona.",
          "Silnik to serce maszyny - dziÅ› nauczysz siÄ™ je leczyÄ‡.",
          "Twoje rÄ™ce przywracajÄ… Å¼ycie metalowym gigantom."
        ],
        motivation: "Mechanicy to wspÃ³Å‚czeÅ›ni kowale - kujesz bezpieczeÅ„stwo na drogach."
      },
      developer: {
        intro: "ğŸ’» Witaj w cyfrowym warsztacie! Terminal czeka na Twoje pierwsze polecenie.",
        daily: [
          "KaÅ¼da linia kodu to cegieÅ‚ka w cyfrowej przyszÅ‚oÅ›ci.",
          "DziÅ› stworzysz coÅ› z niczego - tylko z logiki i kreatywnoÅ›ci.",
          "Debugowanie to jak rozwiÄ…zywanie zagadek - satysfakcja gwarantowana."
        ],
        motivation: "ProgramiÅ›ci to architekci cyfrowego Å›wiata. Budujesz przyszÅ‚oÅ›Ä‡."
      }
    };

    this.moodResponses = {
      happy: [
        "Åšwietnie siÄ™ cieszÄ™, Å¼e masz dobry dzieÅ„! Ta energia pomoÅ¼e Ci w nauce.",
        "TwÃ³j entuzjazm jest zaraÅºliwy! Wykorzystajmy go do czegoÅ› wielkiego.",
        "Z takÄ… pozytywnÄ… energiÄ… moÅ¼esz gÃ³ry przenosiÄ‡!"
      ],
      sad: [
        "Hej, kaÅ¼dy ma gorsze dni. PamiÄ™taj, Å¼e uczysz siÄ™ dla siebie i swojej przyszÅ‚oÅ›ci.",
        "Wiem, Å¼e jest ciÄ™Å¼ko. Ale wÅ‚aÅ›nie w takich momentach wykuwa siÄ™ charakter.",
        "MoÅ¼e zrÃ³bmy dziÅ› coÅ› Å‚atwiejszego? MaÅ‚e kroki teÅ¼ prowadzÄ… do celu."
      ],
      stressed: [
        "WidzÄ™, Å¼e masz duÅ¼o na gÅ‚owie. PamiÄ™taj - nie musisz wszystkiego robiÄ‡ naraz.",
        "Stres to znak, Å¼e to dla Ciebie waÅ¼ne. WeÅº gÅ‚Ä™boki oddech, podzielimy to na maÅ‚e kroki.",
        "KaÅ¼dy ekspert kiedyÅ› byÅ‚ poczÄ…tkujÄ…cym. Daj sobie czas."
      ],
      motivated: [
        "WOW! Z takÄ… motywacjÄ… moÅ¼esz wszystko! Co chcesz dziÅ› osiÄ…gnÄ…Ä‡?",
        "CzujÄ™ TwojÄ… determinacjÄ™! To jest moment, Å¼eby zrobiÄ‡ coÅ› wielkiego.",
        "Twoja motywacja mnie inspiruje! DziaÅ‚ajmy!"
      ]
    };
  }

  analyzeMood(moodData) {
    const moodScore = moodData.reduce((acc, m) => acc + m.value, 0) / moodData.length;
    
    if (moodScore > 7) return 'happy';
    if (moodScore > 5) return 'motivated';
    if (moodScore > 3) return 'neutral';
    if (moodScore > 2) return 'stressed';
    return 'sad';
  }

  generateDailyGreeting(user) {
    const hour = new Date().getHours();
    const daysSinceStart = Math.floor((Date.now() - user.startDate) / (1000 * 60 * 60 * 24));
    const lastMood = user.moods[user.moods.length - 1];
    
    let greeting = '';
    
    // Time-based greeting
    if (hour < 6)       greeting = `${user.name}, wczeÅ›nie wstaÅ‚eÅ›! Podziwiam TwojÄ… determinacjÄ™. `;
    else if (hour < 12) greeting = `DzieÅ„ dobry, ${user.name}! `;
    else if (hour < 18) greeting = `CzeÅ›Ä‡ ${user.name}! `;
    else if (hour < 22) greeting = `Dobry wieczÃ³r, ${user.name}! `;
    else greeting = `${user.name}, pracujesz do pÃ³Åºna! `;

    // Personalized follow-up based on history
    if (daysSinceStart === 0) {
      greeting += "Jak siÄ™ czujesz przed pierwszym dniem nauki?";
    } else if (user.streak > 7) {
      greeting += `${user.streak} dni z rzÄ™du! JesteÅ› nie do zatrzymania! ğŸ”¥`;
    } else if (lastMood && lastMood.value < 5) {
      greeting += "Wczoraj miaÅ‚eÅ› trudny dzieÅ„. DziÅ› bÄ™dzie lepiej, obiecujÄ™!";
    } else if (user.lastAchievement) {
      greeting += `PamiÄ™tasz jak wczoraj zdobyÅ‚eÅ› '${user.lastAchievement}'? DziÅ› czeka kolejne wyzwanie!`;
    } else {
      const narrative = this.narratives[user.career]?.daily;
      if (narrative) {
        greeting += narrative[Math.floor(Math.random() * narrative.length)];
      }
    }

    return greeting;
  }

  generateMotivation(user, context) {
    const career = user.career;
    const narrative = this.narratives[career];
    
    if (!narrative) return "KaÅ¼dy krok przybliÅ¼a CiÄ™ do celu!";

    let motivation = narrative.motivation + " ";

    // Add context-specific motivation
    if (context.type === 'failure') {
      motivation += "BÅ‚Ä™dy to najlepsi nauczyciele. Edison teÅ¼ nie wynalazÅ‚ Å¼arÃ³wki za pierwszym razem.";
    } else if (context.type === 'success') {
      motivation += `WÅ‚aÅ›nie udowodniÅ‚eÅ›, Å¼e masz to, czego potrzeba. ${user.completedTasks} zadaÅ„ za TobÄ…!`;
    } else if (context.type === 'streak') {
      motivation += `${user.streak} dni ciÄ…gÅ‚ej nauki! Statystycznie, jesteÅ› w top 5% najbardziej zdeterminowanych.`;
    }

    // Add social impact
    motivation += this.getSocialImpact(career);

    return motivation;
  }

  getSocialImpact(career) {
    const impacts = {
      electrician: " Twoja praca ratuje Å¼ycie - wadliwa instalacja to Å›miertelne zagroÅ¼enie. JesteÅ› bohaterem bezpieczeÅ„stwa.",
      chef: " Gotowanie to miÅ‚oÅ›Ä‡ podana na talerzu. Tworzysz wspomnienia i Å‚Ä…czysz ludzi przy stole.",
      mechanic: " KaÅ¼dy naprawiony pojazd to rodzina bezpiecznie docierajÄ…ca do domu. To wielka odpowiedzialnoÅ›Ä‡.",
      developer: " TwÃ³j kod moÅ¼e zmieniÄ‡ Å¼ycie milionÃ³w. Facebook, Google - wszystko zaczÄ™Å‚o siÄ™ od jednej osoby z laptopem.",
      nurse: " BÄ™dziesz pierwszÄ… osobÄ…, ktÃ³rÄ… zobaczÄ… chorzy. TwÃ³j uÅ›miech moÅ¼e byÄ‡ ich jedynÄ… nadziejÄ….",
      carpenter: " Budujesz schronienie, bezpieczeÅ„stwo, dom. To fundament cywilizacji."
    };

    return impacts[career] || " Twoja praca ma znaczenie. Åšwiat potrzebuje takich jak Ty.";
  }

  rememberConversation(topic, response, emotion) {
    this.userProfile.conversations.push({
      date: new Date(),
      topic,
      response,
      emotion,
      id: Date.now()
    });

    // Keep only last 50 conversations
    if (this.userProfile.conversations.length > 50) {
      this.userProfile.conversations.shift();
    }
  }

  getFollowUp() {
    const lastConvo = this.userProfile.conversations[this.userProfile.conversations.length - 1];
    
    if (!lastConvo) return null;

    const daysSince = Math.floor((Date.now() - lastConvo.date) / (1000 * 60 * 60 * 24));
    
    if (daysSince > 3 && daysSince < 7) {
      return `PamiÄ™tasz jak ${daysSince} dni temu rozmawialiÅ›my o ${lastConvo.topic}? Jak Ci poszÅ‚o?`;
    }

    return null;
  }
}

// ============================================
// CAREER PATH QUIZ - PSYCHOLOGICZNY TEST
// ============================================

const CareerQuiz = ({ onComplete }) => {
  const [currentQuestion, setCurrentQuestion] = useState(0);
  const [answers, setAnswers] = useState([]);
  
  const questions = [
    {
      id: 'work_environment',
      question: "WyobraÅº sobie idealny dzieÅ„ pracy. Gdzie jesteÅ›?",
      answers: [
        { text: "W warsztacie peÅ‚nym narzÄ™dzi", value: ['mechanic', 'electrician', 'carpenter'], emoji: "ğŸ”§" },
        { text: "Przy komputerze w cichym biurze", value: ['developer', 'designer', 'analyst'], emoji: "ğŸ’»" },
        { text: "W kuchni peÅ‚nej aromatÃ³w", value: ['chef', 'baker'], emoji: "ğŸ‘¨â€ğŸ³" },
        { text: "WÅ›rÃ³d ludzi, pomagajÄ…c im", value: ['nurse', 'teacher', 'therapist'], emoji: "ğŸ¤" }
      ]
    },
    {
      id: 'problem_solving',
      question: "PopsÑƒĞ» siÄ™ telewizor. Co robisz?",
      answers: [
        { text: "Otwieram go i sprawdzam co jest nie tak", value: ['electrician', 'mechanic'], emoji: "ğŸ”Œ" },
        { text: "Szukam rozwiÄ…zania w internecie", value: ['developer', 'analyst'], emoji: "ğŸ”" },
        { text: "DzwoniÄ™ do specjalisty", value: ['manager', 'coordinator'], emoji: "ğŸ“" },
        { text: "To dobra okazja Å¼eby kupiÄ‡ nowy", value: ['sales', 'marketing'], emoji: "ğŸ›ï¸" }
      ]
    },
    {
      id: 'creativity',
      question: "Dostajesz pudeÅ‚ko losowych przedmiotÃ³w. Co z nimi robisz?",
      answers: [
        { text: "BudujÄ™ coÅ› uÅ¼ytecznego", value: ['carpenter', 'engineer'], emoji: "ğŸ—ï¸" },
        { text: "TworzÄ™ dzieÅ‚o sztuki", value: ['designer', 'artist'], emoji: "ğŸ¨" },
        { text: "OrganizujÄ™ je systematycznie", value: ['analyst', 'accountant'], emoji: "ğŸ“Š" },
        { text: "WymyÅ›lam historiÄ™ o nich", value: ['writer', 'teacher'], emoji: "ğŸ“–" }
      ]
    },
    {
      id: 'stress_response',
      question: "Jest deadline za 2 godziny, a praca w poÅ‚owie. Co czujesz?",
      answers: [
        { text: "Adrenalina! Teraz dam z siebie 200%", value: ['paramedic', 'chef'], emoji: "âš¡" },
        { text: "Spokojnie planujÄ™ co najwaÅ¼niejsze", value: ['developer', 'engineer'], emoji: "ğŸ“‹" },
        { text: "StresujÄ™ siÄ™, ale dziaÅ‚am", value: ['teacher', 'nurse'], emoji: "ğŸ˜°" },
        { text: "Szukam pomocy zespoÅ‚u", value: ['manager', 'coordinator'], emoji: "ğŸ‘¥" }
      ]
    },
    {
      id: 'satisfaction',
      question: "Co daje Ci najwiÄ™kszÄ… satysfakcjÄ™?",
      answers: [
        { text: "Gdy coÅ›, co zepsute, znÃ³w dziaÅ‚a", value: ['mechanic', 'electrician'], emoji: "âœ…" },
        { text: "Gdy ktoÅ› mÃ³wi 'dziÄ™kujÄ™'", value: ['nurse', 'teacher', 'therapist'], emoji: "ğŸ™" },
        { text: "Gdy widzÄ™ efekt swojej pracy", value: ['carpenter', 'chef', 'designer'], emoji: "ğŸ†" },
        { text: "Gdy rozwiÄ…Å¼Ä™ skomplikowany problem", value: ['developer', 'analyst'], emoji: "ğŸ§©" }
      ]
    }
  ];

  const handleAnswer = (answer) => {
    const newAnswers = [...answers, answer];
    setAnswers(newAnswers);

    if (currentQuestion < questions.length - 1) {
      setCurrentQuestion(currentQuestion + 1);
    } else {
      // Analyze answers
      const careerScores = {};
      newAnswers.forEach(ans => {
        ans.value.forEach(career => {
          careerScores[career] = (careerScores[career] || 0) + 1;
        });
      });

      // Get top 3 careers
      const sortedCareers = Object.entries(careerScores)
        .sort((a, b) => b[1] - a[1])
        .slice(0, 3);

      onComplete({
        topCareer: sortedCareers[0][0],
        alternatives: sortedCareers.slice(1).map(c => c[0]),
        scores: careerScores
      });
    }
  };

  const progress = ((currentQuestion + 1) / questions.length) * 100;

  return (
    <div className="min-h-screen bg-gradient-to-br from-purple-600 via-blue-600 to-cyan-600 p-6">
      <div className="max-w-2xl mx-auto">
        {/* Progress Bar */}
        <div className="mb-8">
          <div className="flex justify-between items-center mb-2">
            <span className="text-white font-semibold">Pytanie {currentQuestion + 1} z {questions.length}</span>
            <span className="text-white">{Math.round(progress)}%</span>
          </div>
          <div className="h-3 bg-white/20 rounded-full overflow-hidden">
            <div 
              className="h-full bg-white transition-all duration-500 ease-out"
              style={{ width: `${progress}%` }}
            />
          </div>
        </div>

        {/* Question Card */}
        <div className="bg-white rounded-3xl shadow-2xl p-8 transform transition-all duration-500">
          <div className="text-center mb-8">
            <div className="text-6xl mb-4">ğŸ¤”</div>
            <h2 className="text-2xl font-bold text-gray-800 mb-2">
              {questions[currentQuestion].question}
            </h2>
          </div>

          <div className="space-y-4">
            {questions[currentQuestion].answers.map((answer, idx) => (
              <button
                key={idx}
                onClick={() => handleAnswer(answer)}
                className="w-full p-6 bg-gradient-to-r from-blue-50 to-purple-50 rounded-2xl hover:from-blue-100 hover:to-purple-100 transform hover:scale-105 transition-all duration-300 text-left flex items-center space-x-4 group"
              >
                <span className="text-4xl group-hover:animate-bounce">{answer.emoji}</span>
                <span className="text-lg font-medium text-gray-800">{answer.text}</span>
              </button>
            ))}
          </div>
        </div>
      </div>
    </div>
  );
};

// ============================================
// DAILY MOOD CHECK - EMOCJONALNY CHECK-IN
// ============================================

const DailyMoodCheck = ({ onComplete, userName, previousMoods = [] }) => {
  const [mood, setMood] = useState(5);
  const [feeling, setFeeling] = useState('');
  const [motivation, setMotivation] = useState('');
  const [showFollowUp, setShowFollowUp] = useState(false);
  
  const ai = useRef(new EmotionalAI()).current;

  const feelings = [
    { emoji: 'ğŸ˜Š', label: 'SzczÄ™Å›liwy', value: 'happy' },
    { emoji: 'ğŸ˜”', label: 'Smutny', value: 'sad' },
    { emoji: 'ğŸ˜Ÿ', label: 'Zestresowany', value: 'stressed' },
    { emoji: 'ğŸ˜´', label: 'ZmÄ™czony', value: 'tired' },
    { emoji: 'ğŸ’ª', label: 'Zmotywowany', value: 'motivated' },
    { emoji: 'ğŸ˜', label: 'Neutralny', value: 'neutral' }
  ];

  const motivations = [
    "ChcÄ™ lepiej zarabiaÄ‡",
    "Szukam nowej pasji",
    "Rodzina na mnie liczy",
    "ChcÄ™ byÄ‡ niezaleÅ¼ny",
    "Nudzi mnie obecna praca",
    "MarzÄ™ o wÅ‚asnym biznesie"
  ];

  const handleSubmit = () => {
    const moodData = {
      date: new Date(),
      mood,
      feeling,
      motivation,
      followUp: null
    };

    // Generate AI response based on mood
    const aiMood = ai.analyzeMood([{ value: mood }]);
    const response = ai.moodResponses[aiMood][Math.floor(Math.random() * ai.moodResponses[aiMood].length)];
    
    moodData.aiResponse = response;

    // Check if we should ask follow-up based on patterns
    if (previousMoods.length > 2) {
      const lastThreeMoods = previousMoods.slice(-3);
      const avgMood = lastThreeMoods.reduce((a, b) => a + b.mood, 0) / 3;
      
      if (avgMood < 4) {
        setShowFollowUp(true);
        return;
      }
    }

    onComplete(moodData);
  };

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-6 z-50">
      <div className="bg-white rounded-3xl max-w-lg w-full p-8 transform transition-all">
        {!showFollowUp ? (
          <>
            <div className="text-center mb-6">
              <h2 className="text-2xl font-bold mb-2">
                CzeÅ›Ä‡ {userName}! ğŸ‘‹
              </h2>
              <p className="text-gray-600">Jak siÄ™ dziÅ› czujesz?</p>
            </div>

            {/* Mood Slider */}
            <div className="mb-8">
              <div className="flex justify-between mb-4">
                <span className="text-3xl">ğŸ˜¢</span>
                <span className="text-3xl">ğŸ˜</span>
                <span className="text-3xl">ğŸ˜Š</span>
              </div>
              <input
                type="range"
                min="1"
                max="10"
                value={mood}
                onChange={(e) => setMood(Number(e.target.value))}
                className="w-full h-3 bg-gradient-to-r from-red-400 via-yellow-400 to-green-400 rounded-full appearance-none cursor-pointer"
              />
              <div className="text-center mt-2 text-4xl font-bold">
                {mood}/10
              </div>
            </div>

            {/* Feelings */}
            <div className="mb-6">
              <p className="font-semibold mb-3">Co najbardziej opisuje TwÃ³j stan?</p>
              <div className="grid grid-cols-3 gap-3">
                {feelings.map(f => (
                  <button
                    key={f.value}
                    onClick={() => setFeeling(f.value)}
                    className={`p-3 rounded-xl transition-all ${
                      feeling === f.value 
                        ? 'bg-blue-100 border-2 border-blue-500' 
                        : 'bg-gray-50 hover:bg-gray-100'
                    }`}
                  >
                    <div className="text-2xl mb-1">{f.emoji}</div>
                    <div className="text-xs">{f.label}</div>
                  </button>
                ))}
              </div>
            </div>

            {/* Motivation */}
            <div className="mb-6">
              <p className="font-semibold mb-3">Co CiÄ™ motywuje do nauki?</p>
              <div className="space-y-2">
                {motivations.map(m => (
                  <button
                    key={m}
                    onClick={() => setMotivation(m)}
                    className={`w-full text-left p-3 rounded-lg transition-all ${
                      motivation === m
                        ? 'bg-purple-100 border-2 border-purple-500'
                        : 'bg-gray-50 hover:bg-gray-100'
                    }`}
                  >
                    {m}
                  </button>
                ))}
              </div>
            </div>

            <button
              onClick={handleSubmit}
              className="w-full py-4 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-xl font-bold hover:from-blue-700 hover:to-purple-700 transition-all"
            >
              Zacznij dzieÅ„ nauki â†’
            </button>
          </>
        ) : (
          <div className="text-center">
            <div className="text-6xl mb-4">ğŸ¤—</div>
            <h3 className="text-xl font-bold mb-4">
              ZauwaÅ¼yÅ‚em, Å¼e ostatnio jest Ci ciÄ™Å¼ko...
            </h3>
            <p className="text-gray-600 mb-6">
              PamiÄ™taj, Å¼e nie jesteÅ› sam. KaÅ¼dy sukces zaczyna siÄ™ od maÅ‚ego kroku.
              MoÅ¼e dziÅ› zrÃ³bmy coÅ› Å‚atwiejszego? Albo po prostu porozmawiajmy?
            </p>
            <div className="space-y-3">
              <button
                onClick={() => onComplete({ needsSupport: true })}
                className="w-full py-3 bg-green-500 text-white rounded-xl font-bold"
              >
                Tak, potrzebujÄ™ wsparcia
              </button>
              <button
                onClick={() => onComplete({ needsSupport: false })}
                className="w-full py-3 bg-gray-200 text-gray-700 rounded-xl"
              >
                Nie, dam radÄ™
              </button>
            </div>
          </div>
        )}
      </div>
    </div>
  );
};

// ============================================
// MAIN IMMERSIVE CAREER SYSTEM
// ============================================

const ImmersiveCareerSystem = () => {
  const [stage, setStage] = useState('welcome'); // welcome, quiz, mood, career
  const [userData, setUserData] = useState({
    name: '',
    career: null,
    level: 1,
    xp: 0,
    streak: 0,
    moods: [],
    lastInteraction: null
  });
  
  const [showDailyMood, setShowDailyMood] = useState(false);
  const [selectedPath, setSelectedPath] = useState(null);
  
  const ai = useRef(new EmotionalAI()).current;

  // Career narratives with immersive descriptions
  const careers = {
    electrician: {
      title: "Elektryk - Mistrz PrÄ…du",
      emoji: "âš¡",
      narrative: "Kontrolujesz niewidzialnÄ… siÅ‚Ä™, ktÃ³ra napÄ™dza Å›wiat. KaÅ¼de Twoje dziaÅ‚anie to bezpieczeÅ„stwo tysiÄ™cy ludzi.",
      firstDay: "Pierwszy dzieÅ„ w warsztacie. Mistrz Kowalski, 30 lat doÅ›wiadczenia, wita CiÄ™ sÅ‚owami: 'PrÄ…d nie wybacza bÅ‚Ä™dÃ³w, ale szanuje tych, ktÃ³rzy go rozumiejÄ….'",
      missions: [
        "Misja 1: Pierwsza Instalacja - PodÅ‚Ä…cz gniazdko w sposÃ³b bezpieczny",
        "Misja 2: Diagnostyka - ZnajdÅº usterkÄ™ w domowej instalacji",
        "Misja 3: Modernizacja - WymieÅ„ stary bezpiecznik na nowoczesny"
      ]
    },
    chef: {
      title: "Szef Kuchni - Alchemik SmakÃ³w",
      emoji: "ğŸ‘¨â€ğŸ³",
      narrative: "Tworzysz sztukÄ™, ktÃ³rÄ… moÅ¼na zjeÅ›Ä‡. KaÅ¼de danie to emocja podana na talerzu.",
      firstDay: "Szef kuchni prowadzi CiÄ™ do stanowiska: 'NÃ³Å¼ to przedÅ‚uÅ¼enie Twojej rÄ™ki, a kuchnia to Twoja scena. PokaÅ¼, co potrafisz.'",
      missions: [
        "Misja 1: Mise en Place - Przygotuj idealne stanowisko pracy",
        "Misja 2: Pierwszy Sos - StwÃ³rz klasyczny sos holenderski",
        "Misja 3: Serwis - Wydaj 10 daÅ„ w czasie kolacji"
      ]
    },
    developer: {
      title: "Programista - Architekt Cyfrowego Åšwiata",
      emoji: "ğŸ’»",
      narrative: "Piszesz przyszÅ‚oÅ›Ä‡ linijka po linijce. TwÃ³j kod moÅ¼e zmieniÄ‡ Å¼ycie milionÃ³w.",
      firstDay: "Senior developer wita CiÄ™: 'Pierwszy pull request zawsze pamiÄ™ta siÄ™ najdÅ‚uÅ¼ej. Kod to poezja - ma byÄ‡ piÄ™kny i funkcjonalny.'",
      missions: [
        "Misja 1: Hello World - StwÃ³rz pierwszÄ… aplikacjÄ™",
        "Misja 2: Debug Master - ZnajdÅº i napraw 5 bÅ‚Ä™dÃ³w",
        "Misja 3: Feature - Dodaj nowÄ… funkcjonalnoÅ›Ä‡ do projektu"
      ]
    },
    mechanic: {
      title: "Mechanik - Lekarz Maszyn",
      emoji: "ğŸ”§",
      narrative: "Rozumiesz jÄ™zyk silnikÃ³w. KaÅ¼da naprawa to przywrÃ³cona wolnoÅ›Ä‡ podrÃ³Å¼owania.",
      firstDay: "Warsztat pachnie olejem i metalem. Majster podaje Ci klucze: 'Silnik ma duszÄ™. Naucz siÄ™ jej sÅ‚uchaÄ‡.'",
      missions: [
        "Misja 1: Diagnoza - Zidentyfikuj problem w silniku",
        "Misja 2: Wymiana - WymieÅ„ klocki hamulcowe",
        "Misja 3: Tuning - ZwiÄ™ksz moc silnika o 10%"
      ]
    }
  };

  useEffect(() => {
    // Check if it's a new day
    const lastInteraction = localStorage.getItem('lastInteraction');
    if (lastInteraction) {
      const last = new Date(lastInteraction);
      const now = new Date();
      
      if (last.getDate() !== now.getDate()) {
        setShowDailyMood(true);
      }
    }
  }, []);

  const handleQuizComplete = (results) => {
    setUserData({
      ...userData,
      recommendedCareer: results.topCareer,
      alternatives: results.alternatives
    });
    setStage('career-intro');
  };

  // Render different stages
  if (stage === 'welcome') {
    return (
      <div className="min-h-screen bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center p-6">
        <div className="bg-white rounded-3xl p-12 max-w-2xl text-center shadow-2xl">
          <div className="text-8xl mb-6">ğŸš€</div>
          <h1 className="text-4xl font-bold mb-4">Witaj w PathFinder</h1>
          <p className="text-xl text-gray-600 mb-8">
            Znajdziemy dla Ciebie idealnÄ… Å›cieÅ¼kÄ™ kariery i poprowadzimy CiÄ™ przez niÄ… krok po kroku
          </p>
          
          <input
            type="text"
            placeholder="Jak masz na imiÄ™?"
            className="w-full px-6 py-4 text-xl border-2 border-gray-300 rounded-2xl mb-6 focus:border-blue-500 focus:outline-none"
            value={userData.name}
            onChange={(e) => setUserData({...userData, name: e.target.value})}
          />
          
          <button
            onClick={() => userData.name && setStage('quiz')}
            disabled={!userData.name}
            className={`w-full py-4 text-xl font-bold rounded-2xl transition-all ${
              userData.name
                ? 'bg-gradient-to-r from-blue-600 to-purple-600 text-white hover:from-blue-700 hover:to-purple-700'
                : 'bg-gray-200 text-gray-400'
            }`}
          >
            Rozpocznij Test Predyspozycji â†’
          </button>
        </div>
      </div>
    );
  }

  if (stage === 'quiz') {
    return <CareerQuiz onComplete={handleQuizComplete} />;
  }

  if (showDailyMood) {
    return (
      <DailyMoodCheck
        onComplete={handleMoodComplete}
        userName={userData.name}
        previousMoods={userData.moods}
      />
    );
  }

  if (stage === 'career-selection') {
    return (
      <div className="min-h-screen bg-gradient-to-br from-indigo-600 to-purple-600 p-6">
        <div className="max-w-4xl mx-auto">
          <div className="bg-white rounded-3xl p-8 shadow-2xl">
            <h2 className="text-3xl font-bold mb-2 text-center">
              {userData.name}, Twoja idealna Å›cieÅ¼ka to:
            </h2>
            
            <div className="bg-gradient-to-r from-green-50 to-blue-50 rounded-2xl p-6 mb-6">
              <div className="text-center">
                <div className="text-6xl mb-4">
                  {careers[userData.recommendedCareer]?.emoji || 'ğŸ¯'}
                </div>
                <h3 className="text-2xl font-bold mb-2">
                  {careers[userData.recommendedCareer]?.title || userData.recommendedCareer}
                </h3>
                <p className="text-gray-600">
                  {careers[userData.recommendedCareer]?.narrative}
                </p>
                <button
                  onClick={() => selectCareer(userData.recommendedCareer)}
                  className="mt-4 px-8 py-3 bg-green-600 text-white rounded-xl font-bold hover:bg-green-700 transition-all"
                >
                  Wybierz tÄ™ Å›cieÅ¼kÄ™ â†’
                </button>
              </div>
            </div>

            <div className="mb-4">
              <p className="font-semibold mb-3">Alternatywne Å›cieÅ¼ki dla Ciebie:</p>
              <div className="grid grid-cols-2 gap-4">
                {userData.alternatives?.map(alt => (
                  <button
                    key={alt}
                    onClick={() => selectCareer(alt)}
                    className="p-4 bg-gray-50 rounded-xl hover:bg-gray-100 transition-all text-left"
                  >
                    <div className="text-3xl mb-2">{careers[alt]?.emoji || 'ğŸ“š'}</div>
                    <div className="font-semibold">{careers[alt]?.title || alt}</div>
                  </button>
                ))}
              </div>
            </div>
          </div>
        </div>
      </div>
    );
  }

  if (stage === 'career-intro') {
    const career = careers[selectedPath];
    return (
      <div className="min-h-screen bg-gradient-to-br from-gray-900 to-gray-700 text-white p-6">
        <div className="max-w-4xl mx-auto">
          <div className="text-center mb-8">
            <div className="text-8xl mb-4 animate-pulse">{career.emoji}</div>
            <h1 className="text-4xl font-bold mb-4">{career.title}</h1>
            <p className="text-xl opacity-90 mb-8">{career.narrative}</p>
          </div>

          <div className="bg-white/10 backdrop-blur rounded-3xl p-8 mb-6">
            <h2 className="text-2xl font-bold mb-4">ğŸ“– RozdziaÅ‚ 1: Pierwszy DzieÅ„</h2>
            <p className="text-lg leading-relaxed mb-6">{career.firstDay}</p>
            
            <div className="space-y-4">
              <h3 className="text-xl font-semibold">Twoje pierwsze misje:</h3>
              {career.missions.map((mission, idx) => (
                <div key={idx} className="bg-white/5 rounded-xl p-4 flex items-center space-x-4">
                  <div className="text-3xl">ğŸ¯</div>
                  <div>
                    <p className="font-semibold">{mission}</p>
                    <p className="text-sm opacity-75">+100 XP â€¢ Czas: 30 min</p>
                  </div>
                </div>
              ))}
            </div>
          </div>

          <button
            className="w-full py-4 bg-gradient-to-r from-green-600 to-blue-600 rounded-2xl font-bold text-xl hover:from-green-700 hover:to-blue-700 transition-all"
            onClick={() => alert('Rozpoczynamy przygodÄ™!')}
          >
            Zaczynam PierwszÄ… MisjÄ™ â†’
          </button>
        </div>
      </div>
    );
  }

  return null;
};selection');
  };

  const handleMoodComplete = (moodData) => {
    const newMoods = [...userData.moods, moodData];
    setUserData({
      ...userData,
      moods: newMoods
    });
    
    localStorage.setItem('lastInteraction', new Date().toISOString());
    setShowDailyMood(false);

    // Show AI response
    if (moodData.aiResponse) {
      alert(moodData.aiResponse); // In real app, use a nice notification
    }
  };

  const selectCareer = (careerKey) => {
    setSelectedPath(careerKey);
    const career = careers[careerKey];
    
    // Show immersive narrative
    setUserData({
      ...userData,
      career: careerKey,
      narrative: career.narrative
    });
    
    setStage('career-
